var RemoteStorage=function(){"use strict";function t(){for(var t=0;t<P.length;t++)P[t][0](P[t][1]);P=[],g=!1}function e(e,n){P.push([e,n]),g||(g=!0,E(t,0))}function n(t,e){function n(t){s(e,t)}try{t(function(t){i(e,t)},n)}catch(t){n(t)}}function r(t){var e=t.owner,n=e._state,r=e._data,a=t[n],c=t.then;if("function"==typeof a){n=w;try{r=a(r)}catch(t){s(c,t)}}o(c,r)||(n===w&&i(c,r),n===_&&s(c,r))}function o(t,e){var n;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var r=e.then;if("function"==typeof r)return r.call(e,function(r){n||(n=!0,e===r?a(t,r):i(t,r))},function(e){n||(n=!0,s(t,e))}),!0}}catch(e){return n||s(t,e),!0}return!1}function i(t,e){t!==e&&o(t,e)||a(t,e)}function a(t,n){t._state===b&&(t._state=j,t._data=n,e(u,t))}function s(t,n){t._state===b&&(t._state=j,t._data=n,e(f,t))}function c(t){t._then=t._then.forEach(r)}function u(t){t._state=w,c(t)}function f(t){t._state=_,c(t),!t._handled&&I&&global.process.emit("unhandledRejection",t._data,t)}function h(t){global.process.emit("rejectionHandled",t)}function l(t){if("function"!=typeof t)throw new TypeError("Promise resolver "+t+" is not a function");if(this instanceof l==!1)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],n(t,this)}function d(t,e){return new S(function(n){var r=function(){e.test(document.readyState)&&(document.removeEventListener(t,r),n())};document.addEventListener(t,r),r()})}function p(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function m(){return A+"-"+1*new Date+"-"+(0|9e6*Math.random()).toString(36)}function y(t,e){var n=this;this.baseUrl=t,this.pagePath=e,this.frame=document.createElement("iframe"),this.frame.style.display="none",this.frame.style.visibility="hidden",this.messageQueue={},this.preLoadQueue=[],this.loaded=!1,this.frame.addEventListener("load",function(){n.loaded=!0;var t=n.preLoadQueue;return n.preLoadQueue=[],t.map(function(t){return n.send(t.data).then(t.resolve,t.reject)})},!1),this.frame.src=t+e,window.addEventListener("message",function(t){if(0===t.origin.indexOf(n.baseUrl)){var e=JSON.parse(t.data),r=n.messageQueue[e._requestID];if(r){if("error"in e){var o=new Error(e.error);return void r.reject(o)}r.resolve(e.data),delete n.messageQueue[e._requestID]}}},!1),Q.then(function(){document.body.appendChild(n.frame)}).catch(function(){})}function v(t){this.prefix=t.prefix||"",this.transport=new y(t.baseUrl,t.pagePath),this.obj=t.obj||"localStorage"}var g,b="pending",j="settled",w="fulfilled",_="rejected",O=function(){},I="undefined"!=typeof global&&void 0!==global.process&&"function"==typeof global.process.emit,E="undefined"==typeof setImmediate?setTimeout:setImmediate,P=[];l.prototype={constructor:l,_state:b,_then:null,_data:void 0,_handled:!1,then:function(t,n){var o={owner:this,then:new this.constructor(O),fulfilled:t,rejected:n};return!n&&!t||this._handled||(this._handled=!0,this._state===_&&I&&e(h,this)),this._state===w||this._state===_?e(r,o):this._then.push(o),o.then},catch:function(t){return this.then(null,t)}},l.all=function(t){if(!Array.isArray(t))throw new TypeError("You must pass an array to Promise.all().");return new l(function(e,n){for(var r,o=[],i=0,a=0;a<t.length;a++)(r=t[a])&&"function"==typeof r.then?r.then(function(t){return i++,function(n){o[t]=n,--i||e(o)}}(a),n):o[a]=r;i||e(o)})},l.race=function(t){if(!Array.isArray(t))throw new TypeError("You must pass an array to Promise.race().");return new l(function(e,n){for(var r,o=0;o<t.length;o++)(r=t[o])&&"function"==typeof r.then?r.then(e,n):e(r)})},l.resolve=function(t){return t&&"object"==typeof t&&t.constructor===l?t:new l(function(e){e(t)})},l.reject=function(t){return new l(function(e,n){n(t)})};var L=l,S="function"==typeof Promise?Promise:L,Q=(d("readystatechange",/^(?:interactive|complete)$/),d("DOMContentLoaded",/^(?:interactive|complete)$/)),T=(d("readystatechange",/^complete$/),Object.getOwnPropertySymbols),x=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,q=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,r,o=p(t),i=1;i<arguments.length;i++){n=Object(arguments[i]);for(var a in n)x.call(n,a)&&(o[a]=n[a]);if(T){r=T(n);for(var s=0;s<r.length;s++)k.call(n,r[s])&&(o[r[s]]=n[r[s]])}}return o},A=document.domain;return y.prototype.send=function(t){var e,n,r=new S(function(t,r){e=t,n=r});if(this.loaded){var o=m();this.messageQueue[o]={resolve:e,reject:n},t=q({},t,{_requestID:o}),this.frame.contentWindow.postMessage(JSON.stringify(t),this.baseUrl)}else this.preLoadQueue.push({data:t,resolve:e,reject:n});return r},v.prototype={getItem:function(t){return this.transport.send({obj:this.obj,op:"getItem",args:[this.prefix+":"+t]})},setItem:function(t,e){return this.transport.send({obj:this.obj,op:"setItem",args:[this.prefix+":"+t,e]})},removeItem:function(t){return this.transport.send({obj:this.obj,op:"removeItem",args:[this.prefix+":"+t]})},getItems:function(t){var e=this;return S.all(t.map(function(t){return e.getItem(t)})).then(function(e){var n={};return t.forEach(function(t,r){n[t]=e[r]}),n})},removeItems:function(t){var e=this;return S.all(t.map(function(t){return e.removeItem(t)}))},setItems:function(t){var e=this;return S.all(Object.keys(t).map(function(n){return e.setItem(n,t[n])}))}},v}();
