var RemoteStorage=function(){"use strict";function e(e){return!!e&&"object"==typeof e}function t(t){if(!e(t)||c.call(t)!=d)return!1;var r=Object.getPrototypeOf(t);if(null===r)return!0;var n=r.constructor;return"function"==typeof n&&n instanceof n&&f.call(n)==m}function r(e,n){if(!t(e))return e;null==e&&(e={});for(var o in n)if(u.call(n,o)){var i=n[o];t(i)?e[o]=r(e[o]||{},i):e[o]=i}return e}function n(e){if(null==e||!t(e))return e;for(var n=1,o=arguments.length;n<o;n++)e=r(e,arguments[n]);return e}function o(){return h+"-"+1*new Date+"-"+(0|9e6*Math.random()).toString(36)}function i(e,t){var r=this;this.baseUrl=e,this.pagePath=t,this.frame=document.createElement("iframe"),this.frame.style.display="none",this.frame.style.visibility="hidden",this.messageQueue={},this.preLoadQueue=[],this.loaded=!1,this.frame.addEventListener("load",function(){r.loaded=!0;var e=r.preLoadQueue;return r.preLoadQueue=[],e.map(function(e){return r.send(e.data).then(e.resolve,e.reject)})},!1),this.frame.src=e+t,window.addEventListener("message",function(e){if(0===e.origin.indexOf(r.baseUrl)){var t=JSON.parse(e.data),n=r.messageQueue[t._requestID];if(n){if("error"in t){var o=new Error(t.error);return void n.reject(o)}n.resolve(t.data),delete r.messageQueue[t._requestID]}}},!1),a.then(function(){document.body.appendChild(r.frame)}).catch(function(){})}function s(e){this.prefix=e.prefix||"",this.transport=new i(e.baseUrl,e.pagePath),this.obj=e.obj||"localStorage"}var a=new Promise(function(e){var t=document.readyState;"interactive"===t||"complete"===t?e():document.addEventListener("DOMContentLoaded",function(){return e()})}),u=Object.prototype.hasOwnProperty,c=Object.prototype.toString,f=Function.prototype.toString,m=f.call(Object),d="[object Object]",h=document.domain;return i.prototype.send=function(e){var t,r,i=new Promise(function(e,n){t=e,r=n});if(this.loaded){var s=o();this.messageQueue[s]={resolve:t,reject:r},e=n({},e,{_requestID:s}),this.frame.contentWindow.postMessage(JSON.stringify(e),this.baseUrl)}else this.preLoadQueue.push({data:e,resolve:t,reject:r});return i},s.prototype={getItem:function(e){return this.transport.send({obj:this.obj,op:"getItem",args:[this.prefix+":"+e]})},setItem:function(e,t){return this.transport.send({obj:this.obj,op:"setItem",args:[this.prefix+":"+e,t]})},removeItem:function(e){return this.transport.send({obj:this.obj,op:"removeItem",args:[this.prefix+":"+e]})},getItems:function(e){var t=this;return Promise.all(e.map(function(e){return t.getItem(e)})).then(function(t){var r={};return e.forEach(function(e,n){r[e]=t[n]}),r})},removeItems:function(e){var t=this;return Promise.all(e.map(function(e){return t.removeItem(e)}))},setItems:function(e){var t=this;return Promise.all(Object.keys(e).map(function(r){return t.setItem(r,e[r])}))}},s}();
