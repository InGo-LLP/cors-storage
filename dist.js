var RemoteStorage=function(){"use strict";function e(){return new Promise(function(e){var t=document.readyState;"interactive"===t||"complete"===t?e():document.addEventListener("DOMContentLoaded",function(){return e()})})}function t(e){return!!e&&"object"==typeof e}function r(e){if(!t(e)||c.call(e)!=d)return!1;var r=Object.getPrototypeOf(e);if(null===r)return!0;var n=r.constructor;return"function"==typeof n&&n instanceof n&&f.call(n)==m}function n(e,t){if(!r(e))return e;null==e&&(e={});for(var o in t)if(u.call(t,o)){var i=t[o];r(i)?e[o]=n(e[o]||{},i):e[o]=i}return e}function o(e){if(null==e||!r(e))return e;for(var t=1,o=arguments.length;t<o;t++)e=n(e,arguments[t]);return e}function i(){return h+"-"+1*new Date+"-"+(0|9e6*Math.random()).toString(36)}function s(t,r){var n=this;this.baseUrl=t,this.pagePath=r,this.frame=document.createElement("iframe"),this.frame.style.display="none",this.frame.style.visibility="hidden",this.messageQueue={},this.preLoadQueue=[],this.loaded=!1,this.frame.addEventListener("load",function(){n.loaded=!0;var e=n.preLoadQueue;return n.preLoadQueue=[],e.map(function(e){return n.send(e.data).then(e.resolve,e.reject)})},!1),this.frame.src=t+r,window.addEventListener("message",function(e){if(0===e.origin.indexOf(n.baseUrl)){var t=JSON.parse(e.data),r=n.messageQueue[t._requestID];if(r){if("error"in t){var o=new Error(t.error);return void r.reject(o)}r.resolve(t.data),delete n.messageQueue[t._requestID]}}},!1),e.then(function(){document.body.appendChild(n.frame)}).catch(function(){})}function a(e){this.prefix=e.prefix||"",this.transport=new s(e.baseUrl,e.pagePath),this.obj=e.obj||"localStorage"}var u=Object.prototype.hasOwnProperty,c=Object.prototype.toString,f=Function.prototype.toString,m=f.call(Object),d="[object Object]",h=document.domain;return s.prototype.send=function(e){var t,r,n=new Promise(function(e,n){t=e,r=n});if(this.loaded){var s=i();this.messageQueue[s]={resolve:t,reject:r},e=o({},e,{_requestID:s}),this.frame.contentWindow.postMessage(JSON.stringify(e),this.baseUrl)}else this.preLoadQueue.push({data:e,resolve:t,reject:r});return n},a.prototype={getItem:function(e){return this.transport.send({obj:this.obj,op:"getItem",args:[this.prefix+":"+e]})},setItem:function(e,t){return this.transport.send({obj:this.obj,op:"setItem",args:[this.prefix+":"+e,t]})},removeItem:function(e){return this.transport.send({obj:this.obj,op:"removeItem",args:[this.prefix+":"+e]})},getItems:function(e){var t=this;return Promise.all(e.map(function(e){return t.getItem(e)})).then(function(t){var r={};return e.forEach(function(e,n){r[e]=t[n]}),r})},removeItems:function(e){var t=this;return Promise.all(e.map(function(e){return t.removeItem(e)}))},setItems:function(e){var t=this;return Promise.all(Object.keys(e).map(function(r){return t.setItem(r,e[r])}))}},a}();
